<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>turf: Source: node_modules/turf/node_modules/turf-tin/index.js</title>
    <link href='https://www.mapbox.com/base/latest/base.css' rel='stylesheet' />
    <link href='/assets/css/main.css' rel='stylesheet' />
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/rpl-www.css">
</head>

<body>



<div class='hide-mobile pin-left pint-top pin-bottom col2 quiet-scroll scroll-styled fixed'>

  <div class='clearfix fill-turf-green dark center'>
      <a href='/'>
        <img
        width=80
        class='logo' href='http://turfjs.org' src='/static/assets/img/logo.png' alt='turf'>
      </a>
    <div class='inline pad2y'>
      <div class='tabs'>
        <a href='/static/docs/' class='active'>API Docs</a><a
          href='https://github.com/Turfjs/turf' class='icon github' target="_blank">Source</a>
      </div>
    </div>
  </div>
  <div class='pad1 small'>
    <h3></h3><ul><div class="space-bottom1"><div class="pad0y"><strong class="capitalize" keyline-all>aggregation</strong></div><ul><li class="code"><a href="module-turf_aggregate.html">aggregate</a></li><li class="code"><a href="module-turf_average.html">average</a></li><li class="code"><a href="module-turf_count.html">count</a></li><li class="code"><a href="module-turf_deviation.html">deviation</a></li><li class="code"><a href="module-turf_max.html">max</a></li><li class="code"><a href="module-turf_median.html">median</a></li><li class="code"><a href="module-turf_min.html">min</a></li><li class="code"><a href="module-turf_sum.html">sum</a></li><li class="code"><a href="module-turf_variance.html">variance</a></li></ul></div><div class="space-bottom1"><div class="pad0y"><strong class="capitalize" keyline-all>measurement</strong></div><ul><li class="code"><a href="module-turf_along.html">along</a></li><li class="code"><a href="module-turf_area.html">area</a></li><li class="code"><a href="module-turf_bbox-polygon.html">bbox-polygon</a></li><li class="code"><a href="module-turf_bearing.html">bearing</a></li><li class="code"><a href="module-turf_center.html">center</a></li><li class="code"><a href="module-turf_centroid.html">centroid</a></li><li class="code"><a href="module-turf_destination.html">destination</a></li><li class="code"><a href="module-turf_distance.html">distance</a></li><li class="code"><a href="module-turf_envelope.html">envelope</a></li><li class="code"><a href="module-turf_extent.html">extent</a></li><li class="code"><a href="module-turf_line-distance.html">line-distance</a></li><li class="code"><a href="module-turf_midpoint.html">midpoint</a></li><li class="code"><a href="module-turf_point-on-surface.html">point-on-surface</a></li><li class="code"><a href="module-turf_size.html">size</a></li><li class="code"><a href="module-turf_square.html">square</a></li></ul></div><div class="space-bottom1"><div class="pad0y"><strong class="capitalize" keyline-all>transformation</strong></div><ul><li class="code"><a href="module-turf_bezier.html">bezier</a></li><li class="code"><a href="module-turf_buffer.html">buffer</a></li><li class="code"><a href="module-turf_concave.html">concave</a></li><li class="code"><a href="module-turf_convex.html">convex</a></li><li class="code"><a href="module-turf_difference.html">difference</a></li><li class="code"><a href="module-turf_intersect.html">intersect</a></li><li class="code"><a href="module-turf_merge.html">merge</a></li><li class="code"><a href="module-turf_simplify.html">simplify</a></li><li class="code"><a href="module-turf_union.html">union</a></li></ul></div><div class="space-bottom1"><div class="pad0y"><strong class="capitalize" keyline-all>misc</strong></div><ul><li class="code"><a href="module-turf_combine.html">combine</a></li><li class="code"><a href="module-turf_explode.html">explode</a></li><li class="code"><a href="module-turf_flip.html">flip</a></li><li class="code"><a href="module-turf_kinks.html">kinks</a></li><li class="code"><a href="module-turf_line-slice.html">line-slice</a></li><li class="code"><a href="module-turf_point-on-line.html">point-on-line</a></li></ul></div><div class="space-bottom1"><div class="pad0y"><strong class="capitalize" keyline-all>helper</strong></div><ul><li class="code"><a href="module-turf_featurecollection.html">featurecollection</a></li><li class="code"><a href="module-turf_linestring.html">linestring</a></li><li class="code"><a href="module-turf_point.html">point</a></li><li class="code"><a href="module-turf_polygon.html">polygon</a></li></ul></div><div class="space-bottom1"><div class="pad0y"><strong class="capitalize" keyline-all>data</strong></div><ul><li class="code"><a href="module-turf_filter.html">filter</a></li><li class="code"><a href="module-turf_random.html">random</a></li><li class="code"><a href="module-turf_remove.html">remove</a></li><li class="code"><a href="module-turf_sample.html">sample</a></li></ul></div><div class="space-bottom1"><div class="pad0y"><strong class="capitalize" keyline-all>interpolation</strong></div><ul><li class="code"><a href="module-turf_hex-grid.html">hex-grid</a></li><li class="code"><a href="module-turf_isolines.html">isolines</a></li><li class="code"><a href="module-turf_planepoint.html">planepoint</a></li><li class="code"><a href="module-turf_point-grid.html">point-grid</a></li><li class="code"><a href="module-turf_square-grid.html">square-grid</a></li><li class="code"><a href="module-turf_tin.html">tin</a></li><li class="code"><a href="module-turf_triangle-grid.html">triangle-grid</a></li></ul></div><div class="space-bottom1"><div class="pad0y"><strong class="capitalize" keyline-all>joins</strong></div><ul><li class="code"><a href="module-turf_inside.html">inside</a></li><li class="code"><a href="module-turf_tag.html">tag</a></li><li class="code"><a href="module-turf_within.html">within</a></li></ul></div><div class="space-bottom1"><div class="pad0y"><strong class="capitalize" keyline-all>classification</strong></div><ul><li class="code"><a href="module-turf_jenks.html">jenks</a></li><li class="code"><a href="module-turf_nearest.html">nearest</a></li><li class="code"><a href="module-turf_quantile.html">quantile</a></li><li class="code"><a href="module-turf_reclass.html">reclass</a></li></ul></div></ul><div class="quiet"><h4 class="space-top1">Types</h4><ul><li class="small"><a href="global.html#Feature">Feature</a></li><li class="small"><a href="global.html#FeatureCollection">FeatureCollection</a></li><li class="small"><a href="global.html#GeoJSON">GeoJSON</a></li><li class="small"><a href="global.html#GeometryCollection">GeometryCollection</a></li><li class="small"><a href="global.html#LineString">LineString</a></li><li class="small"><a href="global.html#MultiLineString">MultiLineString</a></li><li class="small"><a href="global.html#MultiPoint">MultiPoint</a></li><li class="small"><a href="global.html#MultiPolygon">MultiPolygon</a></li><li class="small"><a href="global.html#Point">Point</a></li><li class="small"><a href="global.html#Polygon">Polygon</a></li></ul></div>
  </div>
</div>
<div class='limiter margin2'>
    <div class='pad1y pad2x fill-white'>
      <div class='prose'>
        <div class='pad2y'>
          <h1 class='code'>Source: node_modules/turf/node_modules/turf-tin/index.js</h1>
        </div>
        



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>//http://en.wikipedia.org/wiki/Delaunay_triangulation
//https://github.com/ironwallaby/delaunay
var polygon = require('turf-polygon');
var featurecollection = require('turf-featurecollection');

/**
 * Takes a set of {@link Point|points} and the name of a z-value property and
 * creates a [Triangulated Irregular Network](http://en.wikipedia.org/wiki/Triangulated_irregular_network),
 * or a TIN for short, returned as a collection of Polygons. These are often used
 * for developing elevation contour maps or stepped heat visualizations.
 *
 * This triangulates the points, as well as adds properties called `a`, `b`,
 * and `c` representing the value of the given `propertyName` at each of
 * the points that represent the corners of the triangle.
 *
 * @module turf/tin
 * @category interpolation
 * @param {FeatureCollection&lt;Point>} points input points
 * @param {String=} propertyName name of the property from which to pull z values
 * This is optional: if not given, then there will be no extra data added to the derived triangles.
 * @return {FeatureCollection&lt;Polygon>} TIN output
 * @example
 * // generate some random point data
 * var points = turf.random('points', 30, {
 *   bbox: [50, 30, 70, 50]
 * });
 * //=points
 * // add a random property to each point between 0 and 9
 * for (var i = 0; i &lt; points.features.length; i++) {
 *   points.features[i].properties.z = ~~(Math.random() * 9);
 * }
 * var tin = turf.tin(points, 'z')
 * for (var i = 0; i &lt; tin.features.length; i++) {
 *   var properties  = tin.features[i].properties;
 *   // roughly turn the properties of each
 *   // triangle into a fill color
 *   // so we can visualize the result
 *   properties.fill = '#' + properties.a +
 *     properties.b + properties.c;
 * }
 * //=tin
 */
module.exports = function(points, z) {
  //break down points
  return featurecollection(triangulate(points.features.map(function(p) {
    var point = {
      x: p.geometry.coordinates[0],
      y: p.geometry.coordinates[1]
    };
    if (z) point.z = p.properties[z];
    return point;
  })).map(function(triangle) {
    return polygon([[
        [triangle.a.x, triangle.a.y],
        [triangle.b.x, triangle.b.y],
        [triangle.c.x, triangle.c.y],
        [triangle.a.x, triangle.a.y]
    ]], {
        a: triangle.a.z,
        b: triangle.b.z,
        c: triangle.c.z
      });
  }));
};

function Triangle(a, b, c) {
  this.a = a;
  this.b = b;
  this.c = c;

  var A = b.x - a.x,
    B = b.y - a.y,
    C = c.x - a.x,
    D = c.y - a.y,
    E = A * (a.x + b.x) + B * (a.y + b.y),
    F = C * (a.x + c.x) + D * (a.y + c.y),
    G = 2 * (A * (c.y - b.y) - B * (c.x - b.x)),
    minx, miny, dx, dy;

  // If the points of the triangle are collinear, then just find the
  // extremes and use the midpoint as the center of the circumcircle.
  if (Math.abs(G) &lt; 0.000001) {
    minx = Math.min(a.x, b.x, c.x);
    miny = Math.min(a.y, b.y, c.y);
    dx = (Math.max(a.x, b.x, c.x) - minx) * 0.5;
    dy = (Math.max(a.y, b.y, c.y) - miny) * 0.5;

    this.x = minx + dx;
    this.y = miny + dy;
    this.r = dx * dx + dy * dy;
  } else {
    this.x = (D * E - B * F) / G;
    this.y = (A * F - C * E) / G;
    dx = this.x - a.x;
    dy = this.y - a.y;
    this.r = dx * dx + dy * dy;
  }
}

function byX(a, b) {
  return b.x - a.x;
}

function dedup(edges) {
  var j = edges.length,
    a, b, i, m, n;

  outer:
  while (j) {
    b = edges[--j];
    a = edges[--j];
    i = j;
    while (i) {
      n = edges[--i];
      m = edges[--i];
      if ((a === m &amp;&amp; b === n) || (a === n &amp;&amp; b === m)) {
        edges.splice(j, 2);
        edges.splice(i, 2);
        j -= 2;
        continue outer;
      }
    }
  }
}

function triangulate(vertices) {
  // Bail if there aren't enough vertices to form any triangles.
  if (vertices.length &lt; 3)
    return [];

    // Ensure the vertex array is in order of descending X coordinate
    // (which is needed to ensure a subquadratic runtime), and then find
    // the bounding box around the points.
  vertices.sort(byX);

  var i = vertices.length - 1,
    xmin = vertices[i].x,
    xmax = vertices[0].x,
    ymin = vertices[i].y,
    ymax = ymin;

  while (i--) {
    if (vertices[i].y &lt; ymin)
      ymin = vertices[i].y;
    if (vertices[i].y > ymax)
      ymax = vertices[i].y;
  }

  //Find a supertriangle, which is a triangle that surrounds all the
  //vertices. This is used like something of a sentinel value to remove
  //cases in the main algorithm, and is removed before we return any
  // results.

  // Once found, put it in the "open" list. (The "open" list is for
  // triangles who may still need to be considered; the "closed" list is
  // for triangles which do not.)
  var dx = xmax - xmin,
    dy = ymax - ymin,
    dmax = (dx > dy) ? dx : dy,
    xmid = (xmax + xmin) * 0.5,
    ymid = (ymax + ymin) * 0.5,
    open = [
      new Triangle({
        x: xmid - 20 * dmax,
        y: ymid - dmax,
        __sentinel: true
      },
      {
        x: xmid,
        y: ymid + 20 * dmax,
        __sentinel: true
      },
      {
        x: xmid + 20 * dmax,
        y: ymid - dmax,
        __sentinel: true
      }
    )],
    closed = [],
    edges = [],
    j, a, b;

    // Incrementally add each vertex to the mesh.
  i = vertices.length;
  while (i--) {
    // For each open triangle, check to see if the current point is
    // inside it's circumcircle. If it is, remove the triangle and add
    // it's edges to an edge list.
    edges.length = 0;
    j = open.length;
    while (j--) {
      // If this point is to the right of this triangle's circumcircle,
      // then this triangle should never get checked again. Remove it
      // from the open list, add it to the closed list, and skip.
      dx = vertices[i].x - open[j].x;
      if (dx > 0 &amp;&amp; dx * dx > open[j].r) {
        closed.push(open[j]);
        open.splice(j, 1);
        continue;
      }

      // If not, skip this triangle.
      dy = vertices[i].y - open[j].y;
      if (dx * dx + dy * dy > open[j].r)
        continue;

      // Remove the triangle and add it's edges to the edge list.
      edges.push(
        open[j].a, open[j].b,
        open[j].b, open[j].c,
        open[j].c, open[j].a
      );
      open.splice(j, 1);
    }

    // Remove any doubled edges.
    dedup(edges);

    // Add a new triangle for each edge.
    j = edges.length;
    while (j) {
      b = edges[--j];
      a = edges[--j];
      open.push(new Triangle(a, b, vertices[i]));
    }
  }

  // Copy any remaining open triangles to the closed list, and then
  // remove any triangles that share a vertex with the supertriangle.
  Array.prototype.push.apply(closed, open);

  i = closed.length;
  while (i--)
  if (closed[i].a.__sentinel ||
      closed[i].b.__sentinel ||
      closed[i].c.__sentinel)
      closed.splice(i, 1);

  return closed;
}
</code></pre>
        </article>
    </section>




      </div>
    </div>
    <div class='quiet small center pad1y'>
      Library released under <a href='https://github.com/Turfjs/turf/blob/master/LICENSE'>MIT license</a>.
        &copy; 2014 <a href='https://twitter.com/morganherlocker'>Morgan Herlocker</a>.
    </div>
  </div>
<script src='scripts/run.js'> </script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-12158002-13', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
